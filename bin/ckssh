#!/usr/bin/env bash
set -e

err() { echo 2>&1 "$@"; exit 1; }

meaning_of_life() { echo 42; }

find_config_for() {
    local host="$1"
    local conf_file="$HOME/.ssh/ckssh_config"
    [ -r "$conf_file" ] || return 2
    sed -e '/[^ \t]*#/d' -e '/^[ \t]*$/d' "$conf_file" \
        | (while read key value; do
                case "$key" in
                    CK_Host)
                        if [ "$value" = "$host" ]; then
                            while read k v; do case "$k" in
                                CK_DefineCompartment|CK_Host)
                                    return 0;;
                                *)  echo "$k $v";;
                            esac; done;
                        fi;;
                    *)  : ;;
                esac
           done; return 1)
}

case $(basename "$0") in
    bats-exec-test)     : ;;                        # Unit test mode hack
    ckssh)              err "Write me!";;
    *)                  err "Unknown command";;
esac
